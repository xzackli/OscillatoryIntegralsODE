<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · OscillatoryIntegralsODE.jl</title><link rel="canonical" href="https://xzackli.github.io/OscillatoryIntegralsODE.jl/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">OscillatoryIntegralsODE.jl</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Background"><span>Background</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li></ul></li><li><a class="tocitem" href="api_index/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/xzackli/OscillatoryIntegralsODE.jl/blob/master/docs/src/index.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="OscillatoryIntegralsODE"><a class="docs-heading-anchor" href="#OscillatoryIntegralsODE">OscillatoryIntegralsODE</a><a id="OscillatoryIntegralsODE-1"></a><a class="docs-heading-anchor-permalink" href="#OscillatoryIntegralsODE" title="Permalink"></a></h1><p>This package performs highly oscillatory quadrature by combining a Levin method (<a href="https://www.sciencedirect.com/science/article/pii/0377042794001189">Levin 1994</a>) with an ODE solver. It currently supports Bessel, spherical Bessel, and harmonic integrals. </p><h2 id="Background"><a class="docs-heading-anchor" href="#Background">Background</a><a id="Background-1"></a><a class="docs-heading-anchor-permalink" href="#Background" title="Permalink"></a></h2><p>Consider the commonly-encountered class of integrals</p><p class="math-container">\[I = \int_a^b g(x) S(rx) \, dx\]</p><p>where <span>$g(x)$</span> is a well-behaved function, but <span>$S$</span> is rapidly-oscillating for large values of <span>$r$</span>. In cosmology, the spherical Bessel function <span>$j_{\nu}(rx)$</span> is a common example of a highly oscillatory <span>$S$</span>. Traditional Gaussian quadrature has poor convergence properties for such integrals, as the number of required nodes scales with frequency <span>$r$</span>. There is a rich literature on other quadrature approaches (for a review, see <a href="https://people.cs.kuleuven.be/~daan.huybrechs/research/HOQ.pdf">Huybrechs and Olver 2012</a>). This package uses the Levin method in combination with an ODE solver to efficiently evaluate integrals with <span>$S$</span> functions of Bessel <span>$J_{\nu}(rx)$</span>, spherical Bessel <span>$j_{\nu}(rx)$</span>, and harmonic <span>$e^{i \omega x}$</span> for finite <span>$0 &lt; a &lt; b$</span>.</p><p>The main idea of the Levin method (<a href="https://www.sciencedirect.com/science/article/pii/0377042794001189">Levin 1994</a>) is to transform the integral of a rapidly-oscillating function into an equivalent non-rapidly oscillatory system of ordinary differential equations. We now follow Levin, and let <span>$\mathbf{f}(x) = ( f_1(x), \ldots, f_m(x) )^T$</span> be an <span>$m$</span>-vector of non-rapidly oscillatory functions, and <span>$\mathbf{w}(x) = ( w_1(x), \ldots, w_m(x) )^T$</span> be an <span>$m$</span>-vector of linearly independent rapidly oscillatory functions. Now suppose your oscillatory functions <span>$w_i$</span> have some special properties, such that the derivative vector <span>$\mathbf{w}&#39;(x)$</span> is always some linear transformation of <span>$mathbf{w}$</span>. Then we could write </p><p class="math-container">\[\mathbf{w}&#39;(x) = \mathbf{A}(x) \mathbf{w}(x).\]</p><p>We are lucky, as many common rapidly oscillatory functions, such as those of the Bessel, spherical Bessel, harmonic, sine, and cosine transforms, satisfy such a relation. For example, the derivative of the Bessel function can be expressed as a linear combination of two Bessel functions, and they are also subject to a convenient recursion relation among different orders. One only needs <span>$m=2$</span> to be able to write a <span>$\mathbf{w}(x)$</span> containing a desired Bessel function (see later sections).</p><p>Now suppose there exists an <span>$m$</span>-vector of functions <span>$\mathbf{p}(x)$</span> such that </p><p class="math-container">\[\frac{d}{dx} \left( \mathbf{p} \cdot \mathbf{w} \right) \approx \mathbf{f} \cdot \mathbf{w}.\]</p><p>If we could obtain such a <span>$\mathbf{p}$</span>, then by the fundamental theorem of calculus, our integral becomes</p><p class="math-container">\[I \approx \int_a^b \frac{d}{dx} \left( \mathbf{p}   \cdot \mathbf{w} \right) = \mathbf{p}(b) \cdot \mathbf{b} - \mathbf{p}(a) \cdot \mathbf{a}.\]</p><p>We have thus reduced our integral to finding an approximation to functions <span>$\mathbf{p}(x)$</span>. Applying the product rule, we have (recall that we can write <span>$\mathbf{w}^\prime = \mathbf{A} \mathbf{w}$</span>)</p><p class="math-container">\[(\mathbf{p} \cdot \mathbf{w})^\prime = \mathbf{p}^\prime \cdot \mathbf{w} + \mathbf{p} \cdot \mathbf{w}^\prime = \mathbf{p}^\prime \cdot \mathbf{w} + \mathbf{p} \cdot \mathbf{A} \mathbf{w} = (\mathbf{p}^\prime + \mathbf{A}^T \mathbf{p}) \cdot \mathbf{w} \approx \mathbf{f} \cdot \mathbf{w}.\]</p><p>Thus <span>$\mathbf{p}$</span> should be an approximate solution to </p><p class="math-container">\[\mathbf{p}^\prime + \mathbf{A}^T \mathbf{p} = \mathbf{f}.\]</p><p>We solve this ODE using an ODE solver. As there are no boundary conditions here, we generally choose the initial condition <span>$p(a) = \mathbf{0}$</span>. We then only need to obtain the ODE solution at <span>$b$</span>, and we have our integral <span>$I \approx \mathbf{p}(b) \cdot \mathbf{w}(b)$</span>. If the ODE solver is a Runge Kutta method, then there&#39;s a good chance it corresponds to some kind of Taylor-based collocation method, which is typically what the literature discuses.</p><h3 id="Bessel-Functions"><a class="docs-heading-anchor" href="#Bessel-Functions">Bessel Functions</a><a id="Bessel-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Bessel-Functions" title="Permalink"></a></h3><p>Bessel functions of the first kind <span>$J_{\nu}$</span> satisfy </p><p class="math-container">\[J^{\prime}_{\nu - 1}(x) = \frac{\nu - 1}{x} J_{\nu - 1}(x) - J_{\nu}(x), \quad \quad
J^{\prime}_{\nu}(x) =  J_{\nu - 1}(x) - \frac{\nu}{x} J_{\nu}(x)\]</p><p>That means we can have <span>$\mathbf{w}(x) = (J_{\nu - 1}(x), J_{\nu}(x))$</span> and <span>$\mathbf{w}^\prime = \mathbf{A} \mathbf{w}$</span> if </p><p class="math-container">\[\mathbf{A}(x) = \begin{pmatrix}
(\nu - 1) / x &amp; -r \\ 
r &amp;  - \nu / x
\end{pmatrix}\]</p><p>We define <span>$\mathbf{f}(x) = (0, f(x))$</span>. We now have our two variables <span>$\mathbf{p}^\prime + \mathbf{A}^T \mathbf{p} = \mathbf{f}$</span>. Once we solve that ODE, we can get our result <span>$I \approx \mathbf{p}(b) \cdot \mathbf{w}(b)$</span>.</p><h3 id="Spherical-Bessel-Functions"><a class="docs-heading-anchor" href="#Spherical-Bessel-Functions">Spherical Bessel Functions</a><a id="Spherical-Bessel-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Spherical-Bessel-Functions" title="Permalink"></a></h3><p>Spherical Bessel functions of the first kind <span>$j_{\nu}$</span> satisfy a similar differential relation, such that for <span>$\mathbf{w}(x) = (j_{\nu - 1}(x), j_{\nu}(x))$</span>, we have</p><p class="math-container">\[\mathbf{A}(x) = \begin{pmatrix}
(\nu - 1) / x &amp; -r \\ 
r &amp;  - (\nu+1) / x
\end{pmatrix}\]</p><h3 id="Harmonic-Integrals"><a class="docs-heading-anchor" href="#Harmonic-Integrals">Harmonic Integrals</a><a id="Harmonic-Integrals-1"></a><a class="docs-heading-anchor-permalink" href="#Harmonic-Integrals" title="Permalink"></a></h3><p>The function <span>$e^{i \omega x}$</span> requires only <span>$m=1$</span>. In this case we have a scalar <span>$A$</span>,</p><p class="math-container">\[A(x) = i \omega\]</p><p>for <span>$w(x) = e^{i \omega x}$</span>, and pretty trivially <span>$w^\prime(x) = A(x) w(x)$</span>.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>To calculate a univariate integral with a Bessel function</p><p class="math-container">\[I = \int_a^b f(x) J_{\nu}(r x) \, dx,\]</p><p>one needs to initialize a <a href="@ref"><code>BesselJIntegral</code></a> with the output type <code>T</code>, order <span>$\nu$</span> and frequency <span>$r$</span>. Consider an example,</p><p class="math-container">\[I = \int_a^b e^{-x^2/16} J_{100}(200 x) \, dx,\]</p><pre><code class="language-julia">using OscillatoryIntegralsODE
# we integrate the Bessel with this f
f(x) = exp(-x^2/16)
# set up problem with output type Float64, Bessel order nu=100, frequency r=100
bi = BesselJIntegral{Float64}(100., 200.)  # nu, r
# now integrate over (a, b) = (1, 5)
levintegrate(bi, f, 1.0, 5.0; abstol=1e-6, reltol=1e-6)</code></pre><pre><code class="language-none">0.00002612881708428357</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Levin methods for Bessel functions can only integrate <span>$0 &lt; a &lt; b$</span>, because <span>$A(x)$</span> diverges as it approaches zero. If you need to get down to 0, consider using Gauss quadrature from 0 to the first peak in the Bessel function. Probably the fastest way to do this is to use one of the many asymptotic results for the smallest positive zero, i.e. Watson 1922 <span>$x_{\nu} = \nu + 1.855757 \nu^{1/3} + O(\nu^{-1/3})$</span>.</p></div></div><p>We could have used a different ODE integrator. The default <a href="@ref"><code>levintegrate</code></a> uses <code>Vern9</code> from <a href="https://diffeq.sciml.ai/stable/solvers/ode_solve/#Recommended-Methods">OrdinaryDiffEq.jl</a>.</p><pre><code class="language-julia">using OrdinaryDiffEq
levintegrate(bi, f, 1.0, 5.0, Vern9(); abstol=1e-6, reltol=1e-6)</code></pre><p>Note that the keyword arguments for <a href="@ref"><code>levintegrate</code></a> are passed directly to the ODE <code>solve</code> call.</p><p>Similarly for Spherical Bessel functions <span>$j_{\nu}(rx)$</span>, here&#39;s an example integral,</p><p class="math-container">\[I = \int_1^5 e^{-x^2/16} j_{100}(100 x)\, dx\]</p><pre><code class="language-julia">nu = 100.
r = 100.
f(x) = exp(-x^2/16)
bi = SphericalBesselJIntegral{Float64}(nu, r)
levintegrate(bi, f, 1.0, 5.0, Vern9(); abstol=1e-6, reltol=1e-6)</code></pre><pre><code class="language-none">0.0008322179291456167</code></pre><p>We also include an integral type for the harmonic transform <span>$e^{i \omega x}$</span>,</p><pre><code class="language-julia">ω = 100.
f(x) = exp(-x^2/16)
hi = HarmonicIntegral{Complex{Float64}}(ω)
result = levintegrate(hi, f, 1.0, 5.0, Vern9(); abstol=1e-6, reltol=1e-6)</code></pre><pre><code class="language-none">0.003797996803011478 + 0.00995319484859839im</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api_index/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 19 February 2021 03:04">Friday 19 February 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
